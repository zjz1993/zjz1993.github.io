<!DOCTYPE html>
<html lang="en">
<head>
	<meta charset="UTF-8">
	<title>动态数据绑定（一）</title>
	<style>

	</style>
</head>
<body>
	
	<script>
		//构造观察者函数
		function Observer(data) {
			this.data = data;
			this.walk(data);//调用walk()遍历对象属性
		}
		let p = Observer.prototype;//观察者原型
		//采用递归思路，深层遍历对象的每一个属性，并为其绑定getter、setter
		p.walk = function (obj) {
			let val;
			for (let key in obj) {
				if (obj.hasOwnProperty(key)) {
					val = obj[key];
					console.log(typeof val);
					//若对象属性为对象，继续往下找
					if (typeof val === 'object') {
						new Observer(val);
					}
				}
				this.convert(key, val);
			}
		}
		p.convert = function (key, val) {
			Object.defineProperty(this.data, key, {
				enumerable: true,
				configurable: true,
				get: function () {
					console.log('你访问了' + key);
					return val;
				},
				set: function (newVal) {
					console.log('你设置了' + key);
					console.log('新的' + key + '=' + newVal);
					if (newVal === val) {
						return;
					} else {
						val = newVal;
					}
				}
			})
		}
		let data = {
			user: {
				name: "李狗蛋",
				age:"18"
			},
			address: {
				city: "Shanghai"
			},
			other: "None"
		}
		let app = new Observer(data);

	</script>
</body>
</html>